---
layout: post
title:  "Toby's Spring Chap 12: 스프링 웹 기술과 스프링 MVC"
date:   2018-12-15
desc: "Toby's Spring Chap 12: 스프링 웹 기술과 스프링 MVC"
keywords: "spring"
categories: [Web]
tags: [spring]
icon: icon-html
---

스프링은 빠르게 기술의 변화가 일어나는 웹 계층과 여타 계층을 깔끔하게 분리해서 개발하는 아키텍처 모델을 지지한다. 따라서 스프링으로 개발하더라도 웹 계층은 어떤 기술로도 대체 가능하다. 물론 스프링에서도 자체 웹 기술과 프레임워크를 제공하고 있다.

<br>
## 스프링의 웹 프레젠테이션 계층 기술

프레젠테이션 계층은 복잡하고 다양한 기술의 조합으로 구성될 수 있다. 스프링 애플리케이션 입장에서는 간단히 두 가지로 구분할 수 있다.

* 스프링 웹 기술을 사용하는 프레젠테이션 계층
* 스프링 외의 웹 기술을 사용하는 프레젠테이션 계층

스프링은 의도적으로 **서블릿 웹 애플리케이션의 컨텍스트를 두 가지로 분리하였다.**
웹 기술에서 독립적인 비즈니스 서비스 계층과 데이터 엑세스 계층을 담은 **루트 애플리케이션 컨텍스트**와 스프링 웹 기술을 기반으로 동작하는 웹 관련 빈을 담은 **서블릿 애플리케이션 컨텍스트**이다.
이렇게 두 가지로 분리한 이유는 스프링 웹 서블릿 컨텍스트를 다른 기술로도 대체할 수 있도록 하기 위해서이다.

<br>
### 스프링 서블릿 / 스프링 MVC

스프링이 직접 제공하는 서블릿 기반의 MVC 프레임워크이다. 프론트 컨트롤러 역할을 하는 **DispatcherServlet**을 핵심 엔진으로 사용한다. 스프링 서블릿의 모든 컴포넌트는 스프링의 서블릿 애플리케이션 컨텍스트의 빈으로 등록되어 동작한다.

<br>
## 스프링 MVC와 DispatcherServlet의 전략

프레임워크 기술은 보통 두 가지 방향으로 발전한다.

<br>
### 범용적 프레임워크

스프링과 같이 **유연성과 확장성**을 중점을 두고 어떤 종류의 시스템 개발이나 환경, 요구조건에도 잘 들어맞도록 재구성할 수 있는 범용적 프레임워크이다. 이런 프레임워크는 각 계층과 기술 사이의 독립성을 중요하게 생각한다.
각 계층과 기술들이 서로의 내부를 잘 알고 강하게 결합되는 것을 극도로 꺼린다. **각 계층은 정해진 인터페이스 외에는 서로 알지 못한다.**

각 계층은 독립적으로 개발 / 테스트할 수 있고, 다른 계층의 코드에 영향을 주지 않은 채로 자유롭게 변경할 수 있어야 한다.

<br>
### 일체형 프레임워크

제한적인 기술만을 사용하도록 강제하지만, 그 기술의 장점을 극대화하도록 설계된다. 계층 간의 느슨한 결합이 없고, 강하게 결합되어 최적화된 코드를 만든다.

<br>
### 스프링의 지향점

스프링은 모든 기능을 다양한 방법으로 확장하도록 설계되어 있다. **스프링을 잘 사용한다는 것은, 유연한 확장성을 최대한 활용하면서 일체형 프레임워크와 같은 스타일을 지향하는 것이다.** 이는 유연하고 확장성이 뛰어난 구조를 활용해서 최적화된 구조를 만들고, 관례에 따라 빠르게 개발 가능한 스프링 기반의 프레임워크를 만들어서 사용해야 한다는 뜻이다.

스프링이 좋은 프레임워크이므로, 그냥 스프링에 제공하는 기술과 API만 사용하는 것만으로는 부족하다.

스프링은 특정 기술이나 방식에 얽매이지 않으면서 웹 프레젠테이션 계층의 각종 기술을 조합, 확장해서 사용할 수 있는 매우 유연한 웹 애플리케이션 개발의 기본 틀을 제공해준다. 이 틀이 제공하는 다양한 전략의 확장포인트를 이용하여 스프링 스스로 기본적인 MVC 프레임워크를 만들어두었다.

개발자는 MVC 프레임워크 위에 필요한 전략을 추가해서 사용할 수 있어야 한다. MVC 프레임워크를 완성된 고정적인 프레임워크로 보지 말고, 진행하려는 프로젝트의 특성에 맞게 빠르고 편리한 개발이 가능하도록 자신만의 웹 프레임워크를 만드는 데 쓰는 도구라고 생각할 필요가 있다.

스프링의 웹 기술의 핵심이자 기반이 되는 것은 **DispatcherServlet**이다. 이 서블릿은 스프링의 웹 기술을 구성하는 다양한 전략을 DI로 구성해서 확장하도록 만들어진 스프링 서블릿 / MVC의 엔진과 같은 역할을 한다.

<br>
### DispatcherServlet과 MVC 아키텍처

스프링의 웹 기술은 MVC 아키텍처를 근간으로 한다. 정보를 담은 모델과 화면 출력 로직을 담은 뷰, 제어 로직을 담은 컨트롤러로 프레젠테이션 계층의 구성 요소를 분리하고 서로 협력해서 하나의 웹 요청을 처리한다.

MVC 아키텍처는 **프론트 컨트롤러** 패턴과 함께 사용된다.
프론트 컨트롤러 패턴은 **중앙 집중형 컨트롤러를 프레젠테이션 계층의 제일 앞단에 두어 서버로 들어오는 모든 요청을 먼저 받아서 처리하도록 한다.**
프론트 컨트롤러는 먼저 공통적인 작업을 수행한 후, 적절한 세부 컨트롤러로 작업을 위임하고 클라이언트에게 보낼 뷰를 선택하여 최종 결과를 생성하는 등의 작업을 수행한다. 예외가 발생하면 이를 일관된 방식으로 처리하는 것도 프론트 컨트롤러의 역할이다.

스프링 서블릿 / MVC의 핵심은 **DispatcherServlet**이라는 프론트 컨트롤러이다. 이 DispatcherServlet은 MVC 아키텍처로 구성된 프레젠테이션 계층을 만들 수 있도록 설계되어 있다.

<br>

![00.png](/static/assets/img/blog/web/2018-12-15-toby_spring_12_web/00.png)

1. DispatcherServlet의 HTTP 요청 접수

  - 자바 서버의 서블릿 컨테이너는 HTTP 프로토콜을 통해 들어오는 요청이 스프링의 DispatcherServlet으로 할당된 것이면 HTTP 요청정보를 Dispatcher 서블릿으로 전달한다. 보통 web.xml은 다음과 같이 정의되어 있다.

```xml
<servlet-mapping>
  <servlet-name>Spring MVC Dispatcher Servlet</servlet-name>
  <url-pattern>/app/*</url-pattern>
</servlet-mapping>
```

  - 위의 설정은 /app으로 시작하는 모든 요청을 스프링의 프론트 컨트롤러인 DispatcherServlet으로 할당하는 것이다. DispatcherServlet은 공통으로 진행해야하는 작업이 있다면 먼저 수행한다.

2. DispatcherServlet에서 컨트롤러로 HTTP 요청 위임
   
 - DispatcherServlet은 URL이나 파라미터 정보, HTTP 메소드를 참고하여 어떤 컨트롤러로 작업을 위임할지 결정한다. 컨트롤러를 설정하는 것은 DispatcherServlet의 **핸들러 매핑 전략**을 이용한다. 사용자 요청 기준으로 어떤 핸들러에게 작업을 위임할지를 결정해주는 것을 핸들러 매핑 전략이라고 한다.