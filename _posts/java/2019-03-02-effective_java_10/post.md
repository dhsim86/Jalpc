---
layout: post
title:  "Effective Java 10 - 예외"
date:   2019-03-02
desc:  "Effective Java 10 - 예외"
keywords: "java"
categories: [Java]
tags: [java]
icon: icon-html
---

# 예외

<br>
## 69. 예외는 진짜 예외 상황에만 사용하라.

```java
try {
    int i = 0;
    while (true) {
        range[i++].climb();
    }
} catch (ArrayIndexOutOfBoundsException e) {

}
```

위의 코드는 무한 루프를 통해 배열을 순회 후 예외가 발생하면 끝을 내는 코드이다. 이렇게 **예외를 일상적인 제어 흐름으로 쓰여선 안된다. 예외는 오직 예외 상황에서만 쓰라고 설계된 것이다.** 특히 try-catch 문안에 블록 안에 넣으면 JVM이 적용할 수 있는 최적화가 제한될 뿐만 아니라 코드를 헷갈리게 하고 성능을 더 떨어뜨린다. 또한 흐름 제어에 쓰인 예외가 실제 버그를 숨겨 디버깅도 훨씬 어렵게 만들 수 있다.

잘 설계된 API라면 클라이언트가 정상적인 제어 흐름에서 예외를 사용할 일이 없게 해야 한다. 

<br>
## 70. 복구할 수 있는 상황에는 Checked 예외를, 프로그래밍 오류에는 Unchecked 예외를 사용하라.

자바는 문제 상황을 알리는 타입으로 Checked 예외, Unchecked 예외, Error 이렇게 세 가지를 제공하는데 언제 어떤 예외를 사용할지는 지침이 있다.

**호출하는 쪽에서 복구하리라 여겨지는 상황이라면 checked 예외를 사용한다.** 이 것이 checked 예외와 unchecked 예외를 구분하는 규칙이다. checked 예외를 던지면 호출자가 그 예외를 잡아 처리하거나 더 바깥으로 전달하도록 강제하게 된다. 달리 말하면 API 설계자는 API 사용자에게 **checked 예외를 던져 그 상황에서 복구하라고 요구하는 것이다.** 물론 사용자는 무시할 수도 있지만 이는 보통 좋지 않은 생각이다.

**unchecked 예외와 Error는 프로그램에서 잡을 필요가 없거나 통상적으로 잡지 말아야 한다.** 프로그램에서 이를 던졌다는 것은 복구가 불가능하거나 더 실행해봐야 득이 될 것이 없다는 뜻이다. 

**프로그래밍 오류에는 unchecked 예외를 사용해야 한다.** 보통 이런 예외는 전제조건을 만족하지 못했을 경우에 발생한다. 단순히 클라이언트가 API의 명세에 기록된 제약을 지키지 못했을 경우에 발생한다는 것이다.

어떤 문제가 발생했을 때, 이 상황이 복구할 수 있는지 아니면 프로그래밍 오류인지가 명확히 구분되지는 않는다. 예를 들어 말도 안되는 크기의 배열을 할당해 생긴 프로그래밍 오류일 수도 있고, 자원이 부족해서 발생한 것일 수도 있는 것이다. 만약 자원이 일시적으로만 부족하거나 순간적으로 몰린 것이라면 충분히 복구할 수 있는 상황일 것이다. 따라서 이런 상황이 복구할 수 있는 것인지는 API 설계자의 판단에 달렸다. **복구할 수 있다고 생각되면 checked 예외를, 아니면 unchecked 예외를 사용해야 한다.**

**Error는 보통 JVM이 자원 부족, 불변식 깨짐으로 인해 더 이상 수행할 수 없을 경우에 발생한다.** 그러나 Error는 애플리케이션이 던지는 것도 아니고 잡아서도 안된다. 애플리케이션 입장에서는 복구가 가능한 것도 아니기 때문이다. 따라서 Error 클래스를 상속하여 사용하는 일은 없어야 한다.

Exception, RuntimeException, Error를 상속하지 않는 **throwable**도 만들 수 있다. 이 것은 암묵적으로 일반적인 checked 예외처럼 다루지만 사용해봤자 이로울 게 없다. throwable은 정상적인 checked 예외와 나을게 없으면서도 API 사용자를 헷갈리게만 한다.

**예외도 역시 어떤 메서드라도 정의할 수 있는 완벽한 객체이다.** 예외의 메서드는 주로 그 예외를 일으킨 상황에 관한 정보를 코드 형태로 전달하는 데 쓰인다. Checked 예외는 일반적으로 복구할 수 있는 조건에 발생하는데, 호출자가 이 예외 상황에서 벗어날 수 있도록 충분한 정보를 제공하는 것이 중요하다.


